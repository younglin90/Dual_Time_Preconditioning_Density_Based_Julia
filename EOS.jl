#= include("./module.jl")
include("./controls.jl")
using .mesh =#

function EOS!(
    ğŸ‘‰::controls, cell::Vector{mesh.Cell}
)


    for i in cell
        Ïáµ¢ = zeros(Float64, 2, 1)
        Ïáµ¢ = zeros(Float64, 2, 1)
        Hâ‚œáµ¢ = zeros(Float64, 2, 1)
        cáµ¢ = zeros(Float64, 2, 1)
        âˆ‚Ïâˆ‚páµ¢ = zeros(Float64, 2, 1)
        âˆ‚Ïâˆ‚Táµ¢ = zeros(Float64, 2, 1)
        âˆ‚Hâ‚œâˆ‚páµ¢ = zeros(Float64, 2, 1)
        âˆ‚Hâ‚œâˆ‚Táµ¢ = zeros(Float64, 2, 1)

        i.var[ğŸ‘‰.Yâ‚] = max(min(i.var[ğŸ‘‰.Yâ‚],1.0),0.0)
        i.var[ğŸ‘‰.Yâ‚‚] = 1.0 - i.var[ğŸ‘‰.Yâ‚]

        j = 1
        (Ïáµ¢[j], Hâ‚œáµ¢[j], cáµ¢[j], âˆ‚Ïâˆ‚páµ¢[j], âˆ‚Ïâˆ‚Táµ¢[j], âˆ‚Hâ‚œâˆ‚páµ¢[j], âˆ‚Hâ‚œâˆ‚Táµ¢[j]) = 
        eosNASG(i.var[ğŸ‘‰.p], i.var[ğŸ‘‰.u], i.var[ğŸ‘‰.v], i.var[ğŸ‘‰.w], i.var[ğŸ‘‰.T])
        j = 2
        (Ïáµ¢[j], Hâ‚œáµ¢[j], cáµ¢[j], âˆ‚Ïâˆ‚páµ¢[j], âˆ‚Ïâˆ‚Táµ¢[j], âˆ‚Hâ‚œâˆ‚páµ¢[j], âˆ‚Hâ‚œâˆ‚Táµ¢[j]) = 
        eosIdeal(i.var[ğŸ‘‰.p], i.var[ğŸ‘‰.u], i.var[ğŸ‘‰.v], i.var[ğŸ‘‰.w], i.var[ğŸ‘‰.T])

        Ï = 1.0/(i.var[ğŸ‘‰.Yâ‚]/Ïáµ¢[1]+i.var[ğŸ‘‰.Yâ‚‚]/Ïáµ¢[2])

        i.var[ğŸ‘‰.Î±â‚] = Ï*i.var[ğŸ‘‰.Yâ‚]/Ïáµ¢[1]
        i.var[ğŸ‘‰.Î±â‚] = max(min(i.var[ğŸ‘‰.Î±â‚],1.0),0.0)
        i.var[ğŸ‘‰.Î±â‚‚] = 1.0 - i.var[ğŸ‘‰.Î±â‚]

        i.var[ğŸ‘‰.Ï] = Ï
        i.var[ğŸ‘‰.Hâ‚œ] = i.var[ğŸ‘‰.Yâ‚]*Hâ‚œáµ¢[1] + i.var[ğŸ‘‰.Yâ‚‚]*Hâ‚œáµ¢[2]

        #i.var[ğŸ‘‰.âˆ‚Ïâˆ‚p] = i.var[ğŸ‘‰.Î±â‚]*âˆ‚Ïâˆ‚páµ¢[1] + i.var[ğŸ‘‰.Î±â‚‚]*âˆ‚Ïâˆ‚páµ¢[2]
        #i.var[ğŸ‘‰.âˆ‚Ïâˆ‚T] = i.var[ğŸ‘‰.Î±â‚]*âˆ‚Ïâˆ‚Táµ¢[1] + i.var[ğŸ‘‰.Î±â‚‚]*âˆ‚Ïâˆ‚Táµ¢[2]
        i.var[ğŸ‘‰.âˆ‚Ïâˆ‚p] = 
			Ï^2*(i.var[ğŸ‘‰.Yâ‚]/Ïáµ¢[1]^2*âˆ‚Ïâˆ‚páµ¢[1] + 
				 i.var[ğŸ‘‰.Yâ‚‚]/Ïáµ¢[2]^2*âˆ‚Ïâˆ‚páµ¢[2])
        i.var[ğŸ‘‰.âˆ‚Ïâˆ‚T] = 
			Ï^2*(i.var[ğŸ‘‰.Yâ‚]/Ïáµ¢[1]^2*âˆ‚Ïâˆ‚Táµ¢[1] + 
				 i.var[ğŸ‘‰.Yâ‚‚]/Ïáµ¢[2]^2*âˆ‚Ïâˆ‚Táµ¢[2])

        i.var[ğŸ‘‰.âˆ‚Hâ‚œâˆ‚p] = i.var[ğŸ‘‰.Yâ‚]*âˆ‚Hâ‚œâˆ‚páµ¢[1] + i.var[ğŸ‘‰.Yâ‚‚]*âˆ‚Hâ‚œâˆ‚páµ¢[2]
        i.var[ğŸ‘‰.âˆ‚Hâ‚œâˆ‚T] = i.var[ğŸ‘‰.Yâ‚]*âˆ‚Hâ‚œâˆ‚Táµ¢[1] + i.var[ğŸ‘‰.Yâ‚‚]*âˆ‚Hâ‚œâˆ‚Táµ¢[2]

        i.var[ğŸ‘‰.âˆ‚Ïâˆ‚Yâ‚] = -Ï^2.0*(1.0/Ïáµ¢[1]-1.0/Ïáµ¢[2])
        i.var[ğŸ‘‰.âˆ‚Hâ‚œâˆ‚Yâ‚] = Hâ‚œáµ¢[1]-Hâ‚œáµ¢[2]

        i.var[ğŸ‘‰.c] = i.var[ğŸ‘‰.âˆ‚Ïâˆ‚p] + 1.0/Ï*i.var[ğŸ‘‰.âˆ‚Ïâˆ‚T]/i.var[ğŸ‘‰.âˆ‚Hâ‚œâˆ‚T]*(1.0-Ï*i.var[ğŸ‘‰.âˆ‚Hâ‚œâˆ‚p])
        i.var[ğŸ‘‰.c] = âˆš(1.0/i.var[ğŸ‘‰.c])


    end


end



function faceEOS!(
	p::Float64,u::Float64,v::Float64,w::Float64,T::Float64,Yâ‚::Float64
)


	Ïáµ¢ = zeros(Float64, 2, 1)
	Ïáµ¢ = zeros(Float64, 2, 1)
	Hâ‚œáµ¢ = zeros(Float64, 2, 1)
	cáµ¢ = zeros(Float64, 2, 1)
	âˆ‚Ïâˆ‚páµ¢ = zeros(Float64, 2, 1)
	âˆ‚Ïâˆ‚Táµ¢ = zeros(Float64, 2, 1)
	âˆ‚Hâ‚œâˆ‚páµ¢ = zeros(Float64, 2, 1)
	âˆ‚Hâ‚œâˆ‚Táµ¢ = zeros(Float64, 2, 1)

	Yâ‚ = max(min(Yâ‚,1.0),0.0)
	Yâ‚‚ = 1.0 - Yâ‚

	j = 1
	(Ïáµ¢[j], Hâ‚œáµ¢[j], cáµ¢[j], âˆ‚Ïâˆ‚páµ¢[j], âˆ‚Ïâˆ‚Táµ¢[j], âˆ‚Hâ‚œâˆ‚páµ¢[j], âˆ‚Hâ‚œâˆ‚Táµ¢[j]) = 
	eosNASG(p, u, v, w, T)
	j = 2
	(Ïáµ¢[j], Hâ‚œáµ¢[j], cáµ¢[j], âˆ‚Ïâˆ‚páµ¢[j], âˆ‚Ïâˆ‚Táµ¢[j], âˆ‚Hâ‚œâˆ‚páµ¢[j], âˆ‚Hâ‚œâˆ‚Táµ¢[j]) = 
	eosIdeal(p, u, v, w, T)

	Ï = 1.0/(Yâ‚/Ïáµ¢[1]+Yâ‚‚/Ïáµ¢[2])

	Î±â‚ = Ï*Yâ‚/Ïáµ¢[1]
	Î±â‚ = max(min(Î±â‚,1.0),0.0)
	Î±â‚‚ = 1.0 - Î±â‚

	Hâ‚œ = Yâ‚*Hâ‚œáµ¢[1] + Yâ‚‚*Hâ‚œáµ¢[2]

	#âˆ‚Ïâˆ‚p = Î±â‚*âˆ‚Ïâˆ‚páµ¢[1] + Î±â‚‚*âˆ‚Ïâˆ‚páµ¢[2]
	#âˆ‚Ïâˆ‚T = Î±â‚*âˆ‚Ïâˆ‚Táµ¢[1] + Î±â‚‚*âˆ‚Ïâˆ‚Táµ¢[2]
    âˆ‚Ïâˆ‚p = Ï^2*(Yâ‚/Ïáµ¢[1]^2*âˆ‚Ïâˆ‚páµ¢[1] + Yâ‚‚/Ïáµ¢[2]^2*âˆ‚Ïâˆ‚páµ¢[2])
    âˆ‚Ïâˆ‚T = Ï^2*(Yâ‚/Ïáµ¢[1]^2*âˆ‚Ïâˆ‚Táµ¢[1] + Yâ‚‚/Ïáµ¢[2]^2*âˆ‚Ïâˆ‚Táµ¢[2])

	âˆ‚Hâ‚œâˆ‚p = Yâ‚*âˆ‚Hâ‚œâˆ‚Táµ¢[1] + Yâ‚‚*âˆ‚Hâ‚œâˆ‚Táµ¢[2]
	âˆ‚Hâ‚œâˆ‚T = Yâ‚*âˆ‚Hâ‚œâˆ‚Táµ¢[1] + Yâ‚‚*âˆ‚Hâ‚œâˆ‚Táµ¢[2]

	#âˆ‚Ïâˆ‚Yâ‚ = -Ï*Ï*(1.0/Ïáµ¢[1]-1.0/Ïáµ¢[2])
	#âˆ‚Hâ‚œâˆ‚Yâ‚ = Hâ‚œáµ¢[1]-Hâ‚œáµ¢[2]

	c = âˆ‚Ïâˆ‚p + 1.0/Ï*âˆ‚Ïâˆ‚T/âˆ‚Hâ‚œâˆ‚T*(1.0-Ï*âˆ‚Hâ‚œâˆ‚p)
	c = âˆš(1.0/c)

	return Ï, Hâ‚œ, c


end




function eosIdeal(
    p, u, v, w, T
)
	uÂ² = u^2+v^2+w^2
	
	cáµ¥ = 707.0
    Î³ = 1.4
	
	câ‚š = Î³*cáµ¥
		
	# density of each phase
	Ï = 1.0/( (Î³-1.0)*cáµ¥*T/p )
	c = âˆš( Î³/Ï*p )

	# d(rho)/d(p)
	âˆ‚Ïâˆ‚p = Ï/p
	
	# d(rho)/d(T)
	âˆ‚Ïâˆ‚T = -Ï/T

	# d(h)/d(p)
	âˆ‚Hâ‚œâˆ‚p = 0.0
	# d(h)/d(T)
	âˆ‚Hâ‚œâˆ‚T = Î³*cáµ¥

	# internal energy of each phase
	# internal_energy = (p+gam*pinf)/(gam-1.0)*(1.0/rhoi-bNASG)+q

	# enthalpy of each phase
	h = Î³*cáµ¥*T

		   
	# eti = internal_energy + 0.5*usqrt
	Hâ‚œ = h + 0.5*uÂ²

	# cvi = cv
	# cpi = cp	

    return Ï, Hâ‚œ, c, âˆ‚Ïâˆ‚p, âˆ‚Ïâˆ‚T, âˆ‚Hâ‚œâˆ‚p, âˆ‚Hâ‚œâˆ‚T
end		

function eosNASG(
    p, u, v, w, T
)
	uÂ² = u^2+v^2+w^2
	
    pâˆ = 621780000.0
	cáµ¥ = 3610.0
    Î³ = 1.19
    b = 6.7212e-4
	q = -1177788.0
	
	câ‚š = Î³*cáµ¥
		
	# density of each phase
	Ï = 1.0/( (Î³-1.0)*cáµ¥*T/(p+pâˆ)+b )
	c = âˆš( Î³/(Ï*Ï)*(p+pâˆ)/(1.0/Ï-b) )

	# d(rho)/d(p)
	âˆ‚Ïâˆ‚p = Ï*Ï*(1.0/Ï-b)/(p+pâˆ)
	
	# d(rho)/d(T)
	âˆ‚Ïâˆ‚T = -Ï*Ï*(1.0/Ï-b)/T

	# d(h)/d(p)
	âˆ‚Hâ‚œâˆ‚p = b
	# d(h)/d(T)
	âˆ‚Hâ‚œâˆ‚T = Î³*cáµ¥

	# internal energy of each phase
	# internal_energy = (p+gam*pinf)/(gam-1.0)*(1.0/rhoi-bNASG)+q

	# enthalpy of each phase
	h = Î³*cáµ¥*T + b*p + q

		   
	# eti = internal_energy + 0.5*usqrt
	Hâ‚œ = h + 0.5*uÂ²

	# cvi = cv
	# cpi = cp	

    return Ï, Hâ‚œ, c, âˆ‚Ïâˆ‚p, âˆ‚Ïâˆ‚T, âˆ‚Hâ‚œâˆ‚p, âˆ‚Hâ‚œâˆ‚T
end